(()=>{"use strict";class t{constructor(t,e=0){this.length=t,this.hits=e,this.sunk=!1}hit(){this.hits+=1}isSunk(){return this.hits>=this.length&&(this.sunk=!0,this.sunk)}}class e{constructor(){this.board=this.initialiseBoard(),this.hitMap=new Set}initialiseBoard(){const t=[];for(let e=0;e<10;e++)t.push(new Array(10).fill(null));return t}placeShip(e,i,s){const[r,a]=e,h=new t(s);if(!this.isValidPlacement(e,i,s))return!1;if("H"===i){for(let t=0;t<s;t++)this.board[r+t][a]=h;return!0}if("V"===i){for(let t=0;t<s;t++)this.board[r][a+t]=h;return!0}}isValidPlacement(t,e,i){const[s,r]=t;if("H"===e){for(let t=0;t<i;t++)if(s+t>=10||this.board[s+t][r])return!1}else for(let t=0;t<i;t++)if(r+t>=10||this.board[s][r+t])return!1;return this.areaClear(s,r,e,i)}areaClear(t,e,i,s){const r=Math.max(t-1,0);let a=Math.min(t+s,9);const h=Math.max(e-1,0);let o=Math.min(e+1,9);"V"===i&&(o=Math.min(e+s,9),a=Math.min(t+1,9));for(let t=r;t<=a;t++)for(let e=h;e<=o;e++)if(this.board[t][e])return!1;return!0}receiveAttack(t){const[e,i]=t;return!(this.hitMap.has(`${e}${i}`)||(this.hitMap.add(`${e}${i}`),!this.board[e][i]))&&(this.board[e][i].hit(),this.board[e][i].isSunk(),"hit")}}class i{static playerBoard=null;static computerBoard=null;static playerShips=[];static computerShips=[];static queue=[];static selectionShips=[2,2,3,4,4];static selectedShipIndex=0;static playerDirection="H";static end=!0;static playerTurn(t,e){if(!this.end)return this.computerBoard.hitMap.has(`${t}${e}`)?void 0:(setTimeout((()=>{this.computerTurn()}),100),this.computerBoard.receiveAttack([t,e]),this.checkWinner())}static enqueueNeighbours(t,e,i=void 0,s=void 0){if(void 0!==s&&void 0!==s){const r=[t+t-i,e+e-s];return this.queue=[],this.queue.push({coords:r,last:[t,e]}),"hit"}const r=t+1,a=t-1,h=e+1,o=e-1;return h<10&&!this.playerBoard.hitMap.has(`${t}${h}`)&&this.queue.push({coords:[t,h],last:[t,e]}),o>=0&&!this.playerBoard.hitMap.has(`${t}${o}`)&&this.queue.push({coords:[t,o],last:[t,e]}),r<10&&!this.playerBoard.hitMap.has(`${r}${e}`)&&this.queue.push({coords:[r,e],last:[t,e]}),a>=0&&!this.playerBoard.hitMap.has(`${a}${e}`)&&this.queue.push({coords:[a,e],last:[t,e]}),"hit"}static computerTurn(t=void 0,e=void 0,i=100){if(this.end)return;let s=Math.floor(10*Math.random()),r=Math.floor(10*Math.random());if(!(i<=0)){if(void 0!==t&&void 0!==e)return this.playerBoard.receiveAttack([t,e])&&this.enqueueNeighbours(t,e),this.checkWinner();if(this.queue.length>0){const t=this.queue.shift();[s,r]=t.coords;const[e,i]=t.last;return this.playerBoard.receiveAttack([s,r])&&this.enqueueNeighbours(s,r,e,i),this.checkWinner()}return this.playerBoard.hitMap.has(`${s}${r}`)?(this.computerTurn(i-1),this.checkWinner()):(this.playerBoard.receiveAttack([s,r])&&this.enqueueNeighbours(s,r),this.checkWinner())}}static initializeBoards(){this.computerShips=[],this.playerShips=[],this.playerBoard=new e,this.computerBoard=new e;const t=[2,2,3,4,4],i=["H","V"];for(let e=0;e<t.length;e++){let s,r,a=!1;const h=i[Math.floor(2*Math.random())];for(;!a;)s=Math.floor(10*Math.random()),r=Math.floor(10*Math.random()),this.computerBoard.isValidPlacement([s,r],h,t[e])&&(a=this.computerBoard.placeShip([s,r],h,t[e]));this.computerShips.push(this.computerBoard.board[s][r])}}static checkWinner(){const t=document.querySelector("#message");let e=0,i=0;return this.refreshGrid(),this.playerShips.forEach((t=>{!0===t.sunk&&e++})),e>=this.playerShips.length?(t.textContent="Computer won",void(this.end=!0)):(this.computerShips.forEach((t=>{!0===t.sunk&&i++})),i>=this.computerShips.length?(t.textContent="playerWon",void(this.end=!0)):void(t.textContent="next Turn"))}static initializeGrid(){const t=document.querySelector("#player-board"),e=document.querySelector("#computer-board");t.innerHTML="",e.innerHTML="";const i=document.querySelector("#message");for(let i=0;i<10;i++)for(let s=0;s<10;s++){const r=document.createElement("div"),a=document.createElement("div");r.classList="gridCell player-square",a.classList="gridCell computer-square",a.addEventListener("click",(()=>{this.playerTurn(s,i)})),r.addEventListener("click",(()=>{this.placeSelectedShip([s,i])})),t.appendChild(r),e.appendChild(a)}i.textContent="player turn"}static refreshGrid(){const t=document.querySelectorAll(".computer-square"),e=document.querySelectorAll(".player-square");t.forEach(((t,e)=>{const i=e%10,s=Math.floor(e/10);this.computerBoard.hitMap.has(`${i}${s}`)&&this.computerBoard.board[i][s]?t.style.backgroundColor="cyan":this.computerBoard.hitMap.has(`${i}${s}`)&&t.classList.add("hit")})),e.forEach(((t,e)=>{const i=e%10,s=Math.floor(e/10);this.playerBoard.board[i][s]&&t.setAttribute("id","ship"),this.playerBoard.hitMap.has(`${i}${s}`)&&this.playerBoard.board[i][s]?t.style.backgroundColor="cyan":this.playerBoard.hitMap.has(`${i}${s}`)&&t.classList.add("hit")}))}static activateGameControls(){const t=document.querySelector("#play");document.querySelector("#replay").addEventListener("click",(()=>{this.end=!0,this.initializeBoards(),this.initializeGrid(),this.selectionShips=[2,2,3,4,4]})),t.addEventListener("click",(()=>{0===this.selectionShips.length&&(this.end=!1,this.refreshGrid())})),document.addEventListener("keypress",(t=>{"R"!==t.key&&"r"!==t.key||(this.playerDirection="H"===this.playerDirection?"V":"H")})),this.selectShip()}static placeSelectedShip(t){const[e,i]=t;if(!this.end)return;if(this.selectionShips.length<=0)return;const s=this.selectionShips[this.selectedShipIndex];this.playerBoard.placeShip(t,this.playerDirection,s)&&(this.playerShips.push(this.playerBoard.board[e][i]),this.selectionShips.splice(this.selectedShipIndex,1)),this.refreshGrid()}static selectShip(){document.querySelectorAll(".shipType").forEach(((t,e)=>{t.addEventListener("click",(()=>{this.selectedShipIndex=this.selectionShips.indexOf(e+2)}))}))}}document.addEventListener("DOMContentLoaded",(()=>{i.initializeBoards(),i.initializeGrid(),i.activateGameControls()}))})();