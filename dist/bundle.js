(()=>{"use strict";class t{constructor(t,e=0){this.length=t,this.hits=e,this.sunk=!1}hit(){this.hits+=1}isSunk(){return this.hits>=this.length&&(this.sunk=!0,this.sunk)}}class e{constructor(){this.board=this.initialiseBoard(),this.hitMap=new Set}initialiseBoard(){const t=[];for(let e=0;e<10;e++)t.push(new Array(10).fill(null));return t}placeShip(e,i,r){const[s,a]=e,h=new t(r);if(!this.isValidPlacement(e,i,r))return!1;if("H"===i){for(let t=0;t<r;t++)this.board[s+t][a]=h;return!0}if("V"===i){for(let t=0;t<r;t++)this.board[s][a+t]=h;return!0}}isValidPlacement(t,e,i){const[r,s]=t;if("H"===e){for(let t=0;t<i;t++)if(r+t>=10||this.board[r+t][s])return!1}else for(let t=0;t<i;t++)if(s+t>=10||this.board[r][s+t])return!1;return this.areaClear(r,s,e,i)}areaClear(t,e,i,r){const s=Math.max(t-1,0);let a=Math.min(t+r,9);const h=Math.max(e-1,0);let o=Math.min(e+1,9);"V"===i&&(o=Math.min(e+r,9),a=Math.min(t+1,9));for(let t=s;t<=a;t++)for(let e=h;e<=o;e++)if(this.board[t][e])return!1;return!0}receiveAttack(t){const[e,i]=t;return!(this.hitMap.has(`${e}${i}`)||(this.hitMap.add(`${e}${i}`),!this.board[e][i]))&&(this.board[e][i].hit(),this.board[e][i].isSunk(),"hit")}}class i{static playerBoard=null;static computerBoard=null;static playerShips=[];static computerShips=[];static queue=[];static selectionShips=[2,2,3,4,4];static selectedShipIndex=0;static playerDirection="H";static end=!0;playerTurn(t,e){if(!this.end)return this.computerBoard.hitMap.has(`${t}${e}`)?void 0:(setTimeout((()=>{this.computerTurn()}),100),this.computerBoard.receiveAttack([t,e]),this.checkWinner())}static enqueueNeighbours(t,e,i=void 0,r=void 0){if(void 0!==r&&void 0!==r){const s=[t+t-i,e+e-r];return this.queue=[],this.queue.push({coords:s,last:[t,e]}),"hit"}const s=t+1,a=t-1,h=e+1,o=e-1;return h<10&&!this.playerBoard.hitMap.has(`${t}${h}`)&&this.queue.push({coords:[t,h],last:[t,e]}),o>=0&&!this.playerBoard.hitMap.has(`${t}${o}`)&&this.queue.push({coords:[t,o],last:[t,e]}),s<10&&!this.playerBoard.hitMap.has(`${s}${e}`)&&this.queue.push({coords:[s,e],last:[t,e]}),a>=0&&!this.playerBoard.hitMap.has(`${a}${e}`)&&this.queue.push({coords:[a,e],last:[t,e]}),"hit"}static computerTurn(t=void 0,e=void 0,i=100){if(this.end)return;let r=Math.floor(10*Math.random()),s=Math.floor(10*Math.random());if(!(i<=0)){if(void 0!==t&&void 0!==e)return this.playerBoard.receiveAttack([t,e])&&this.enqueueNeighbours(t,e),this.checkWinner();if(this.queue.length>0){const t=this.queue.shift();[r,s]=t.coords;const[e,i]=t.last;return this.playerBoard.receiveAttack([r,s])&&this.enqueueNeighbours(r,s,e,i),this.checkWinner()}return this.playerBoard.hitMap.has(`${r}${s}`)?(this.computerTurn(i-1),this.checkWinner()):(this.playerBoard.receiveAttack([r,s])&&this.enqueueNeighbours(r,s),this.checkWinner())}}static initializeBoards(){this.computerShips=[],this.playerShips=[],this.playerBoard=new e,this.computerBoard=new e;const t=[2,2,3,4,4],i=["H","V"];for(let e=0;e<t.length;e++){let r,s,a=!1;const h=i[Math.floor(2*Math.random())];for(;!a;)r=Math.floor(10*Math.random()),s=Math.floor(10*Math.random()),this.computerBoard.isValidPlacement([r,s],h,t[e])&&(a=this.computerBoard.placeShip([r,s],h,t[e]));this.computerShips.push(this.computerBoard.board[r][s])}}static checkWinner(){const t=document.querySelector("#message");let e=0,i=0;return this.refreshGrid(),this.playerShips.forEach((t=>{!0===t.sunk&&e++})),e>=this.playerShips.length?(t.textContent="Computer won",void(this.end=!0)):(this.computerShips.forEach((t=>{!0===t.sunk&&i++})),i>=this.computerShips.length?(t.textContent="playerWon",void(this.end=!0)):void(t.textContent="next Turn"))}static initializeGrid(){const t=document.querySelector("#player-board"),e=document.querySelector("#computer-board");t.innerHTML="",e.innerHTML="";const i=document.querySelector("#message");for(let i=0;i<10;i++)for(let r=0;r<10;r++){const s=document.createElement("div"),a=document.createElement("div");s.classList="gridCell player-square",a.classList="gridCell computer-square",a.addEventListener("click",(()=>{this.playerTurn(r,i)})),s.addEventListener("click",(()=>{this.placeSelectedShip([r,i])})),this.computerBoard.board[r][i]&&a.setAttribute("id","ship"),t.appendChild(s),e.appendChild(a)}i.textContent="player turn"}static refreshGrid(){const t=document.querySelectorAll(".computer-square"),e=document.querySelectorAll(".player-square");t.forEach(((t,e)=>{const i=e%10,r=Math.floor(e/10);this.computerBoard.hitMap.has(`${i}${r}`)&&this.computerBoard.board[i][r]?t.style.backgroundColor="cyan":this.computerBoard.hitMap.has(`${i}${r}`)&&t.classList.add("hit")})),e.forEach(((t,e)=>{const i=e%10,r=Math.floor(e/10);this.playerBoard.board[i][r]&&t.setAttribute("id","ship"),this.playerBoard.hitMap.has(`${i}${r}`)&&this.playerBoard.board[i][r]?t.style.backgroundColor="cyan":this.playerBoard.hitMap.has(`${i}${r}`)&&t.classList.add("hit")}))}static activateGameControls(){const t=document.querySelector("#play"),e=document.querySelector("#replay");this.selectionShips=[2,2,3,4,4],e.addEventListener("click",(()=>{this.initializeBoards(),this.initializeGrid()})),t.addEventListener("click",(()=>{this.end=!1,this.refreshGrid()}))}static placeSelectedShip(t){const[e,i]=t;if(!this.end)return;if(this.selectionShips.length<=0)return;const r=this.selectionShips[this.selectedShipIndex];this.playerBoard.placeShip(t,this.playerDirection,r)&&(this.playerShips.push(this.playerBoard.board[e][i]),this.selectionShips.splice(this.selectedShipIndex,1)),this.initializeGrid(),this.refreshGrid()}static selectShip(){document.querySelectorAll(".shipType").forEach(((t,e)=>{t.addEventListener("click",(()=>{this.selectedShipIndex=this.selectionShips.indexOf(e+2)}))}))}static changeDirection(){document.addEventListener("keypress",(t=>{"R"!==t.key&&"r"!==t.key||(this.playerDirection="H"===this.playerDirection?"V":"H")}))}}document.addEventListener("DOMContentLoaded",(()=>{i.initializeBoards(),i.initializeGrid(),i.activateGameControls()}))})();